<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.ssafy.project.model.mapper.PlanMapper">

 	<resultMap type="planDto" id="plan">
		<result column="plan_id" property="planId"/>
		<result column="user_id" property="userId"/>
		<result column="plan_title" property="planTitle"/>
		<result column="plan_startdate" property="planStartDate"/>
		<result column="plan_enddate" property="planEndDate"/>
		<result column="plan_contents" property="planContents"/>
		<result column="plan_path" property="planPath"/>
		<result column="plan_sido_code" property="planSidoCode"/>
		<result column="plan_gugun_code" property="planGugunCode"/>
		<result column="plan_view_cnt" property="planViewCnt"/>
		<result column="plan_like_cnt" property="planLikeCnt"/>
		<result column="plan_create_at" property="planCreateAt"/>
		<result column="plan_delete_at" property="planDeleteAt"/>
	</resultMap>
	
	<resultMap type="placeDto" id="place">
		<result column="id" property="id"/>
		<result column="address_name" property="address_name"/>
		<result column="category_group_code" property="category_group_code"/>
		<result column="category_group_name" property="category_group_name"/>
		<result column="category_name" property="category_name"/>
		<result column="distance" property="distance"/>
		<result column="phone" property="phone"/>
		<result column="place_name" property="place_name"/>
		<result column="place_url" property="place_url"/>
		<result column="road_address_name" property="road_address_name"/>
		<result column="x" property="x"/>
		<result column="y" property="y"/>
		<result column="day" property="day"/>
		<result column="order" property="order"/>
		<result column="plan_id" property="plan_id"/>
	</resultMap>
	
 
 	<insert id="writePlan" parameterType="planDto">
		insert into plans (user_id, plan_title, plan_contents, plan_startdate, plan_enddate, plan_path, plan_sido_code, plan_gugun_code)
		values (#{userId}, #{planTitle}, #{planContents}, #{planStartDate}, #{planEndDate}, #{planPath}, #{planSidoCode}, #{planGugunCode})
	</insert>
	 
 	<insert id="writePlace" parameterType="placeDto">
		insert into places (day, order, plan_id, user_id, address_name, category_group_code, category_group_name, category_name, distance, phone, place_name, place_url, road_address_name, x, y)
		values (#{day}, #{order}, #{plan_id}, #{user_id}, #{address_name}, #{category_group_code}, #{category_group_name}, #{category_name}, #{distance}, #{phone}, #{place_name}, #{place_url}, #{road_address_name}, #{x}, #{y})
	</insert>
	
	<select id="listPlan" parameterType="map" resultMap="plan">
		select *
		from plans 
		<if test="word != null and word != ''">
			where plan_title like concat('%', #{word}, '%') 
			or plan_contents like concat('%', #{word}, '%') 
		</if> 
		order by plan_id desc
		limit #{start}, #{spp}
	</select>
	
	
	<select id="getTotalCount" parameterType="map" resultType="int">
		select count(plan_id) 
		from plans 
		<if test="word != null and word != ''"> 
			where plan_title like concat('%', #{word}, '%') 
			or plan_contents like concat('%', #{word}, '%') 
		</if>
	</select>
	
	
	<update id="updateHit" parameterType="planDto">
		update plans
		set plan_view_cnt = plan_view_cnt + 1
		where plan_id = #{planId}
	</update>
	
	<update id="updateLike" parameterType="planDto">
		update plans
		set plan_like_cnt = plan_like_cnt + 1
		where plan_id = #{planId}
	</update>
		
	<select id="getPlan" parameterType="int"
		resultMap="plan">
		select *
		from plans
		where plan_id = #{planId}
	</select>
	
	<update id="modifyPlan" parameterType="planDto">
		update plans
		set plan_title = #{planTitle}, plan_contents = #{planContents}, plan_startdate = #{planStartDate}, plan_enddate = #{planEndDate}, 
			plan_path = #{planPath}, plan_sido_code = #{planSidoCode}, plan_gugun_code = #{planGugunCode} 
		where plan_id = #{planId}
	</update>
	
	<delete id="deletePlan" parameterType="int">
		delete from plans
		where plan_id = #{planId}
	</delete>
	
	<select id="listMyPlan" parameterType="string" resultMap="plan">
		select *
		from plans
		where user_id = #{userId}
	</select>  
	
</mapper>